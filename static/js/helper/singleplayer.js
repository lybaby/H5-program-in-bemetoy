/*! 09-05-2016 */
define("helper/singleplayer",["comm/utils","comm/zeptodata","comm/clickevent","helper/app","helper/temphtml","helper/jrange","jplayer","require","exports"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=function(a){var b=$(a),c=b.find(".player");c.playedTime=b.find(".played-time"),c._totalTime=b.find(".total-time"),c._slider=b.find(".slider"),c._slider.jRange({from:0,to:100,step:1,width:"68%",format:"%s",ondragchange:function(a){this.__timeout&&clearTimeout(this.__timeout),this.__timeout=setTimeout(function(){c.jPlayer("playHead",a)},100)}}),b.on("click",".btn-play",function(a){a.stopPropagation();var b=$(".player");$.each(b,function(a,b){$(b).jPlayer("pause")});var d=$(this);return d.hasClass("btn-pause")?c.jPlayer("pause"):c.jPlayer("play"),!1}).on("click",".play",function(){var a=$(".player");$.each(a,function(a,b){$(b).jPlayer("pause"),$(b).removeClass("pause")});var b=$(this);return b.hasClass("pause")?(c.jPlayer("pause"),b.removeClass("pause")):(c.jPlayer("play"),b.addClass("pause")),$(".player"),!1})};i.initSinglePlayer=function(b,c,d){var f=$(e.playSingleHtml);f.attr("id",b),f.insertAfter(d),j("#"+b);var g=$("#"+b);g.find(".player-slider").show(),g.addClass("item-option-showplay");var h=g.find(".player");g.find(".total-time").text(a.formatTime(c.song_time||c.radio_time)),k(g,h,c.url),f.find(".btn-single").removeClass("btn-play"),h.jPlayer("setMedia",{mp3:c.url})},i.initSingleWeixinPlayer=function(b,c,d){var f=$(e.playBearSongHtml);f.attr("id",b),f.insertAfter(d),j("#"+b);var g=$("#"+b);g.find(".player-slider").show(),g.addClass("item-option-showplay");var h=g.find(".player");g.find(".total-time").text(a.formatTime(c.song_time||c.radio_time)),k(g,h,c.url),f.find(".btn-single").removeClass("btn-single"),h.jPlayer("setMedia",{mp3:c.url})};var k=function(b,c,d){c.playedTime=b.find(".played-time"),c._totalTime=b.find(".total-time"),c._slider=b.find(".slider"),c.jPlayer({ready:function(a){c.jPlayer("setMedia",{mp3:d}),a.jPlayer.html.used&&a.jPlayer.html.audio.available&&(this._audio=$(this).data("jPlayer").htmlElement.audio)},progress:function(a){var b=a.jPlayer.status.remaining||0,c=(a.jPlayer.status.readyState,0),d=this;if("object"==typeof d._audio.buffered&&d._audio.buffered.length>0){if(d._audio.duration>0){for(var e=0,f=0;f<d._audio.buffered.length;f++)e+=d._audio.buffered.end(f)-d._audio.buffered.start(f);c=100*e/d._audio.duration}}else c=0;var g=100*(d._audio.duration-b)/d._audio.duration;c=g+c>=100?100:g+c,$(".load-bar").css("width",c+"%"),console.log(c)},timeupdate:function(b){var d=b.jPlayer.status,e=d.currentPercentAbsolute;c.playedTime.text(a.formatTime(d.currentTime||0));var f=c._slider.data("plugin_jRange");f&&(f.setValue(e),100==e&&(f.setValue(0),c.playedTime.text("00:00")))},play:function(a){b.find(".btn-single").length<1&&b.find(".btn-play").addClass("btn-pause")},pause:function(a){b.find(".btn-play").removeClass("btn-pause")},ended:function(a){var b=$(this).parent().parent().index(),c=$(this).parent().parent().parent().find(".music-list"),d=++b%c.length,e=c.eq(d);e.find(".btn-play").click()},smoothPlayBar:!0,supplied:"mp3",preload:"none",wmode:"window"}),c._slider};i.stopPlayer=function(){$jPlayer&&$jPlayer.jPlayer("stop")},i.uninit=function(){$playBox.off("click"),i.stopPlayer()}});