/*! 09-05-2016 */
define("minpage/grow",["comm/utils","comm/url","comm/request","comm/clickevent","comm/unveil","helper/playerbar","helper/singleplayer","helper/app","require","exports"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k={},l={title:"贝美时光说-成长场景",desc:"小囧熊英文乐园",link:location.href,imgUrl:"专辑图片放进来"},m=function(b,c){var d=h.getUA(0),e=h.getUA(1);d>1&&e>0&&$(".share_weixin").show(),d>1&&e>2&&h.setTitle("育儿小妙招"),1==c&&($(".share_weixin").hide(),$(".push-song").hide());var f=$(".grow-banner-box");f.find(".img-cover").attr("src",a.imageUrlStationHead(b.url,1)),f.find(".grow_name").text(b.name),$("#abstract").html(b["abstract"]),$("#description").html(b.description);var g=$("#description").find("embed");$.each(g,function(a,d){p($(d).attr("song_id"),b.id,$(d),c)});var j=$("#description").find("video");$.each(j,function(a,b){var c="";c='<div class="song_list_name">'+$(b).attr("title")+"</div>",c+='<p class="play-video"><video src="'+$(b).attr("src")+'" controls="controls" poster="'+$(b).attr("width")+'"></video></p>',$(c).insertAfter($(b)),$(b).remove()});var m=$("#description").find("article");$.each(m,function(a,b){r($(b).attr("album_id"),$(b),c)});var n=$("#description").find("station");$.each(n,function(a,b){t($(b).attr("album_id"),$(b),c)});var o=$("#description").find("a");$.each(o,function(a,b){var c=$(b),f=c.attr("href");f.indexOf("book")>0&&(c.attr("href","javascript:void(0);"),c.attr("url",f),c.attr("id","link_"+a),$("#link_"+a).on("click",function(){var a=$(this).attr("url"),b=a.split("type=")[1];return 0==+b?(window.location.href=f,!1):(2>=d||void 0==d)&&(1>e||void 0==e)||void 0==b?(window.location.href=f,!1):void window.bemetoy.webViewTouchWithUrl(f,+b)}))});var q="";if(b.songs&&b.songs.length>0&&(q=1==c?a.template("J_temp-item-weixin",{list:b.songs}):a.template("J_temp-item",{list:b.songs}),$("#J_song-box").html(q),$.each(b.songs,function(a,b){b._type="album",b.tag="album",k[b.id]=b}),$("#song_list_name").html(b.song_name),$(".song_list").show()),b.albums&&b.albums.length>0&&($("#album_list_name").html(b.album_name),$.each(b.albums,function(a,b){1==c?b.id="#!m=weixin&id="+b.id+"&type=album":b.id="#!m=albuminfo&id="+b.id}),q=a.template("J_temp-albumitem",{list:b.albums}),$("#J_album-box").html(q),$(".album").show(),$("img.lazy").unveil()),h.backScroll(),l.title=b.name,l.desc=b["abstract"],l.imgUrl=a.imageUrl(b.url),1==c)var c=i(["minpage/weixin"],function(a){a.getWeixinConfig(l)})},n=function(a,b){c.getRequest({url:BEME.APIURL+"/grow/growInfo?id="+a,successfn:function(a){h.loaded(),0===a.code&&m(a.data,b)}})},o=function(a,b,c,e){var f="",h="music_"+a.id;f='<li class="music '+h+'" sid="'+a.id+'" md5="'+a.md5+'"  url="'+a.url+'" tag="grow" tagval="'+b+'"  size="'+a.filesize+'" type="'+a.type+'" ><div class="title">'+a.name+'</div><a class="push-grow-song">推送给玩具</a></li>';var i="single_"+a.id;1==e?(g.initSingleWeixinPlayer(i,a,c),$(f).insertAfter(c),$(".push-grow-song").hide()):(g.initSinglePlayer(i,a,c),$(f).insertAfter(c)),c.parent().addClass("music_div"),c.remove(),$("."+h).on("click",".push-grow-song",function(){d.pushSong($(this))})},p=function(a,b,d,e){c.getRequest({url:BEME.APIURL+"/grow/songInfo?id="+a,successfn:function(a){h.loaded(),0===a.code&&o(a.data,b,d,e)}})},q=function(b,c,d){var e="";$.each(b.tags,function(b,c){var d=a.getRandColor();e+='<li style="color:'+d+";border-color:"+d+'">'+c.name+"</li>"});var f="";f=1==d?'<div class="album_list" ><a class="album_link" href="#!m=weixin&type=album&id='+b.id+'">':'<div class="album_list" ><a class="album_link" href="#!m=albuminfo&id='+b.id+'">',f+='<img class="album_img" src="'+b.url+'"><div class="title">'+b.name+'</div><ul class="tags">'+e+"</ul></a></div>",$(f).insertAfter(c),c.remove()},r=function(a,b,d){c.getRequest({url:BEME.APIURL+"/grow/albumInfo?id="+a,successfn:function(a){h.loaded(),0===a.code&&q(a.data,b,d)}})},s=function(a,b,c){var d="";d=1==c?'<div class="album_list" ><a class="album_link" href="#!m=weixin&type=station&id='+a.id+'">':'<div class="album_list" ><a class="album_link" href="#!m=fminfo&id='+a.id+'">',d+='<img class="station_img" src="'+a.head_url+'"><div class="name">'+a.name+'</div><div class="author">主播：'+a.author+"</div></a></div>",$(d).insertAfter(b),b.remove()},t=function(a,b,d){c.getRequest({url:BEME.APIURL+"/grow/stationInfo?id="+a,successfn:function(a){h.loaded(),0===a.code&&s(a.data,b,d)}})},u=function(a,b){$(".share_weixin").on("click",function(){d.shareToWeixin(a,"grow")}),1==b?$("#J_song-box").on("click",".item",function(){var a=$(this),b=a.attr("sid");f.initWeixinPlayer(a,k[+b])}):($("#J_song-box").on("click",".item .item-a",function(){d.pushSong(this)}),$("#J_song-box").on("click",".item-play",function(){d.audition(k,this)}))};j.init=function(){var a=b.getParams();1==a.weixin?h.setTitle("贝美时光说-成长场景"):h.setTitle("成长场景"),n(a.id,a.weixin),u(a.id,a.weixin)},j.uninit=function(){}});