/*! 09-05-2016 */
define("minpage/weixin",["jweixin","comm/utils","comm/url","comm/request","comm/pushsong","comm/clickevent","helper/app","helper/playerbar","page/myalbum","require","exports"],function(a,b,c,d,e,f,g,h,i,j,k){"use strict";var l={},m={title:"这里是标题",desc:"这里是描述语言",link:location.href,imgUrl:"专辑图片放进来"},n=function(a){var c="",d=$("#J_album-box");d.find(".title").text(a.album.name),m.title=a.album.name,m.desc=a.album.description,m.imgUrl=a.album.url,d.find(".img-cover").attr("src",b.imageUrl(a.album.url)),d.find(".desc").text(a.album.description),a.tags&&($.each(a.tags,function(a,d){var e=b.getRandColor();c+='<li style="color:'+e+";border-color:"+e+'">'+d.name+"</li>"}),d.find(".tags").html(c)),d.show(),$("#J_topic-box").hide(),c=b.template("J_temp-item",{list:a.songs}),$("#J_song-box").html(c),$.each(a.songs,function(a,b){l[b.id]=b})},o=function(a){var c="",d=$("#J_topic-box");d.find(".img-cover").attr("src",b.imageUrlStationHead(a.topic.cover)),d.find(".title").text(a.topic.name),m.title=a.topic.name,m.desc=a.topic.description,m.imgUrl=a.topic.cover,$("#J_album-box").hide(),$("#J_topic-box").show(),c=b.template("J_temp-item",{list:a.songs}),$("#J_song-box").html(c),$.each(a.songs,function(a,b){l[b.id]=b})},p=function(a){var c="",d=$("#J_topic-box");d.find(".img-cover").attr("src",b.imageUrlStationHead(a.station.url)),d.find(".title").text(a.station.name),$("#J_album-box").hide(),$("#J_topic-box").show(),m.title=a.station.name,m.desc=a.station.description,m.imgUrl=a.station.url;var e=a.radios.slice(0,8);c=b.template("J_temp-item",{list:e}),$("#J_song-box").html(c),$.each(e,function(a,b){l[b.id]=b})},q=function(a,c){$(".weixin-page").hide();var d=$(".song-page");"album"==c?d.find(".image").attr("src",a.image):(d.find(".image").hide(),d.find(".header-image").css("background-image","url("+a.image+")"),d.find(".header-image").show()),d.find(".name").text(a.name),m.title=a.name,m.desc=a.description,m.imgUrl=b.imageUrl(b.imageUrlStationHead(a.image));var e=d.find(" .play");h.initWeixinSongPlay(e,a),d.show()},r=function(a,b,c){switch(a){case"album":n(b);break;case"topic":o(b);break;case"station":p(b);break;case"song":q(b,c)}k.getWeixinConfig(m)};k.getWeixinConfig=function(a){var b=window.location.href;d.getRequest({url:BEME.APIURL+"/weixin/getWeixinConfig",data:{url:b},successfn:function(b){s(b,a)}})};var s=function(b,c){a.config({debug:!1,appId:b.data.appid,timestamp:b.data.time,nonceStr:b.data.nonce,signature:b.data.sign,jsApiList:["onMenuShareAppMessage","onMenuShareTimeline","onMenuShareQQ","onMenuShareWeibo","onMenuShareQZone"]}),a.ready(function(){a.onMenuShareTimeline(c),a.onMenuShareAppMessage(c),a.onMenuShareQQ(c),a.onMenuShareWeibo(c),a.onMenuShareQZone(c)}),a.error(function(a){})},t=function(a,b,c,e){if(b){var f="";switch(b){case"album":f=BEME.APIURL+"/albums/albumList";break;case"topic":f=BEME.APIURL+"/albums/topicList";break;case"station":f=BEME.APIURL+"/station/radiolist";break;case"song":f=BEME.APIURL+"/weixin/getWeixinSongPage";break;case"radio":f=BEME.APIURL+"/weixin/getWeixinSongPage"}""!=f&&d.getRequest({url:f,data:{id:a,type:b,album_type:c,album_id:e},successfn:function(a){g.loaded(),0===a.code&&r(b,a.data,c)}})}},u=function(a){$("#J_album-desc").on("click",function(){var a=$(this);a.attr("block")?(a.css("display","-webkit-box"),a.attr("block",null)):(a.css("display","block"),a.attr("block",1))}),$("#J_song-box").on("click",".item",function(){var a=$(this),b=a.attr("sid");h.initWeixinPlayer(a,l[+b])}),$(".song-page ").on("click",".play-cover",function(){var a=$(this);a.hasClass("pause")?($("#J_jplayer-weixin-song .btn-song").click(),a.removeClass("pause"),a.attr("src","./static/images/zanting.png")):($("#J_jplayer-weixin-song .btn-song").click(),a.addClass("pause"),a.attr("src","./static/images/bofang.png"))})};k.init=function(){g.setTitle("专辑");var a=c.getParams();g.showHeader(),t(a.id,a.type,a.album_type,a.album_id),u(a.id)},k.uninit=function(){$("#J_album-desc,.select-all, #J_song-box, #J_album-box .favorites").off("click")}});