/*! 09-05-2016 */
define("minpage/bemeipindex",["comm/utils","comm/url","helper/playerbar","comm/request","comm/clickevent","helper/app","helper/temphtml","helper/jrange","require","exports"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k={title:"贝美童趣馆",desc:"超级飞侠故事屋",link:location.href,imgUrl:"专辑图片放进来"},l=function(b,d){var e=$(".ip-page");e.find(".banner .img-cover").attr("src",b.url);var g=a.template("J_temp-item-song",{list:b.song});$(".play-music").html(g);var h=f.getUA(0);1==h&&($(".main-header").show(),$(".main-header .back-btn").show(),$("#J_wrapper").css("padding","1.1rem 0 0 0"),$(".sub").hide(),$(".share_weixin").hide()),1==d&&($(".sub").hide(),$(".share_weixin").hide(),$(".push-song").hide());var j=f.getUA(1);h>1&&j>0&&$(".share_weixin").show(),k.imgUrl=b.url;var l=e.find(" .music-list");c.initIpPlay(l,b.song[0]);var g=a.template("J_temp-item-person",{list:b.planes});if($("#person_list").html(g),1==d)var d=i(["minpage/weixin"],function(a){a.getWeixinConfig(k)});f.backScroll()},m=function(b,c){$.each(b,function(a,b){b.content="第"+b.sequence+"集("+b.update_time.replace(/\-/g,"")+")："+b.sub_name,1==c&&(b.id=b.id+"&weixin=1")});var d="";d=j.changeDate(b[0].update_time)+"刚刚更新："+b[0].sub_name,$("#new-title").text(d),$(".title-box").attr("value",b[0].id);var e=a.template("J_temp-item",{list:b});$("#J_list-box").html(e)},n=function(a,b){d.getLocalRequest({url:BEME.APIURL+"/ip/ipClass?type="+a,successfn:function(a){f.loaded(),0===a.code&&l(a.data,b)}}),d.getLocalRequest({url:BEME.APIURL+"/ip/ipList?type="+a,successfn:function(a){f.loaded(),0===a.code&&m(a.data.list,b)}})};j.changeDate=function(a){var b=new Date(a),c=b.getMonth()+1+"月"+b.getDate()+"日 ";return c},j.showDescriptInfo=function(a){var b=$("#J_random-dec");if(b.length<1)$(document.body).append(g.myipDescription),$("#J_random-dec").on("click",".close-btn",function(){$("#J_random-dec, #J_body-mask").hide(),f.hideMask()});else{var c=$("#J_body-mask").css("display");if("none"!=c)return}var d=["name","en_name","feature","catchword","personal","recommend"];$.each(d,function(b,c){$("#"+c).text(a[c])}),f.showMask(),b.show()};var o=function(a){d.getRequest({url:BEME.APIURL+"/ip/personInfo?id="+a,successfn:function(a){f.loaded(),0===a.code&&j.showDescriptInfo(a.data)}})},p=function(a,b){$("#play-music").on("click",".music-list .push-song",function(){e.pushSong($(this).parent())}),$("#person_list").on("click",".item",function(){var a=$(this).attr("person_id");o(a)}),$(".title-box").on("click",function(){var c=$(this).attr("value"),d="?m=bemeipinfo&id="+c+"&type="+a;1==b&&(d="?m=bemeipinfo&weixin=1&id="+c+"&type="+a),window.location.href=d}),$(".share_weixin").on("click",function(){e.shareToWeixin(a,"ip","ipindex")})};j.init=function(){f.setTitle("超级飞侠故事屋");var a=b.getParams();n(a.type,a.weixin),f.hideAllBox(),p(a.type,a.weixin)},j.uninit=function(){$("#play-music").off("click")}});