/*! 09-05-2016 */
define("page/myplay",["comm/utils","comm/url","comm/request","comm/pushsong","comm/clickevent","page/myalbum","helper/app","helper/playerbar","require","exports"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k={},l=0,m=function(b){if(g.setTitle(b.play.name),0===b.count)return $("#J_songnum").text(0),$(".title").show(),$("#play_list").hide(),void $(".song-fail").show();var c=a.template("J_temp-mpitem",{list:b.songs});$("#J_song_list").html(c),$("#J_songnum").text(b.songs.length),$("#J_play_name").text(b.play.name),$("#J_songnum_all").text(b.songs.length),$(".title").show(),$(".select-all").hide(),$("#J_wrapper .item").find(".checkbox").hide(),$.each(b.songs,function(a,b){b._type="play",b.tag=b.song_type,b.user=!0,k[b.id]=b}),g.backScroll()},n=function(a){c.getRequest({url:BEME.APIURL+"/listen/customPlayDetail?id="+a,successfn:function(a){g.loaded(),0===a.code?m(a.data):($("#play_list").hide(),$(".song-fail").show())}})},o=function(a,b){var d=$(".item");$.each(d,function(a,b){var c=$(b);c.find(".checkbox").attr("value","0"),$(c.find(".checkbox")).find("img").attr("src","./static/images/xuanzekong.png")}),c.getRequest({url:BEME.APIURL+"/albums/deletePlayListSong",data:{ids:a},type:"POST",successfn:function(a){g.showTips("删除歌曲"+a.message),0===a.code&&n(b)}})};j.deletePlay=function(a){o(a,l)};var p=function(a){$("#editplay").on("click",function(){$(".delete-all").show(),$("#J_wrapper .item").find(".checkbox").show(),$("#delete_play").show(),$("#editplay").hide(),$(".back-btn").hide(),$(".title3").hide(),$("#cancel_edit").show()}),$(".select-all").on("click","#cancel",function(){$(".select-all").hide(),$("#J_wrapper .item").find(".checkbox").hide(),$(".title3").show()}),$(".select-all").on("click","#delete",function(){var b=$(".item"),c=[];if($.each(b,function(a,b){var d=$(b),e=d.find(".checkbox").attr("value");1===+e&&c.push(d.attr("rid"))}),0===c.length);else{var d={};d.content="确定删除所选歌曲？",g.showAlert(d,function(){o(c.join(","),a)})}}),$("#J_song_list").on("click",".item .item_a",function(){e.pushSong(this)}),$("#J_song_list").on("click",".item-play",function(){e.audition(k,this)}),$(".title3").on("click",".play-btn",function(){e.pushAllSong(this)}),$("#listen_edit").on("click",function(a){a.stopPropagation(),"none"==$(".top").css("display")?$(".top").show():$(".top").hide()}),$(document).click(function(){$(".top").hide()}),$(".top").on("click",".edit",function(a){a.stopPropagation(),("none"===$(".item").find(".checkbox")[0].style.display||""===$(".item").find(".checkbox")[0].style.display)&&($(".select-all").show(),$(".myplay .title3").hide(),$(".item").find(".checkbox").show(),$(".item").find(".checkbox span").length&&($(".item").find(".checkbox span").hide(),$(".item").find(".checkbox img").show())),$(".top").hide()}),$(".top").on("click",".cancel",function(b){b.stopPropagation(),$("#J_newplay-box").show(),$("#J_newplay-box .play_title").text("修改歌单名"),$("#J_newplay-box #play_name").val(document.title),$("#J_newplay-box #play_name").focus(),$("#J_newplay-box #play_id").attr("value",a),$("#J_newplay-box .btn-ok").css("color","#0091ff"),g.showMask(),$(".top").hide()}),e.newPlayEvent(),$("#J_song_list").on("click",".checkbox",function(){e.check(this)}),$(".select-all").on("click",".left",function(){var a=$(this).parent(),b=a.find(".left").attr("value"),c=$(".item").find(".checkbox");0==+b?(a.find("img").attr("src","./static/images/xuanze.png"),a.find(".left").attr("value",1),$.each(c,function(a,b){$(b).find("img").attr("src","./static/images/xuanze.png"),$(b).attr("value",1)}),$("#delete").removeClass("content_add"),$("#delete").addClass("content")):(a.find("img").attr("src","./static/images/xuanzekong.png"),a.find(".left").attr("value",0),$.each(c,function(a,b){$(b).find("img").attr("src","./static/images/xuanzekong.png"),$(b).attr("value",0)}),$("#delete").removeClass("content"),$("#delete").addClass("content_add"))})};j.init=function(){var c=b.getParams();$(".back-btn").show(),a.headerMenu(),$("#editplay").show(),g.showHeader(),n(c.id),l=c.id,p(c.id)},j.uninit=function(){$("#editplay, .select-all,#listen_edit, #J_play_list, #delete_play, #cancel_edit").off("click")}});