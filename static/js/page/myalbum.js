/*! 09-05-2016 */
define("page/myalbum",["comm/utils","comm/url","comm/request","comm/clickevent","helper/app","helper/temphtml","require","exports"],function(a,b,c,d,e,f,g,h){"use strict";var i=function(b){if($(".select-all").hide(),$(".myalbum .title").show(),b.length){var c=a.template("J_temp-pitem",{list:b});$("#J_play_list").html(c),$("#J_playnum").text(b.length),$("#J_playnum_1").text(b.length)}else $("#J_play_list").html(""),$("#J_playnum").text(0),$("#J_playnum_1").text(0);e.backScroll()},j=function(b){c.getRequest({url:BEME.APIURL+"/albums/userPlayList",type:"post",data:{uid:a.getUid()},successfn:function(a){e.loaded(),0===a.code&&b(a.data)}})},k=function(){c.getRequest({url:BEME.APIURL+"/albums/userPlayList",type:"post",data:{uid:a.getUid()},successfn:function(a){e.loaded(),0===a.code&&i(a.data)}})},l=function(a){var b=$(".item");$.each(b,function(a,b){var c=$(b);c.find(".checkbox").attr("value","0"),$(c.find(".checkbox")).find("img").attr("src","./static/images/xuanzekong.png")}),c.getRequest({url:BEME.APIURL+"/albums/deletePlayList",data:{ids:a},type:"POST",successfn:function(a){0===a.code?(e.showTips("歌单已删除"),k()):e.showTips("歌单删除失败")}})},m=function(b){c.getRequest({url:BEME.APIURL+"/albums/addPlayList",data:{name:b,uid:a.getUid()},type:"POST",successfn:function(a){$("#J_album-alert .ok-btn").removeClass("disabled"),0===a.code&&($("#J_album-alert .new-myalbum").removeClass("showinput"),$("#J_album-alert .input").val(""));var b=$("#J_album-alert"),c=b.attr("ids"),d=b.attr("type"),e=b.attr("album_ids");n(a.data,c,d,e,"")}})},n=function(a,b,d,f,g){d=d||"album",c.getRequest({url:BEME.APIURL+"/albums/insertIntoPlayList",data:{play_id:a,type:d,song_ids:b,album_ids:f},type:"POST",successfn:function(a){if(e.showTips(a.message+"加入歌单"),0===a.code){$("#J_album-alert, #J_body-mask").hide(),$(".caction-box").length&&$(".caction-box").show(),$(".title").length&&$(".title").show(),$("."+g).show(),$(".select-all").hide(),$(".select-all").find(".left").attr("value","0"),$(".select-all").find("img").attr("src","./static/images/xuanzekong.png");var b=$(".item");$.each(b,function(a,b){var c=$(b);c.find(".checkbox").attr("value","0"),$(c.find(".checkbox")).find("img").attr("src","./static/images/xuanzekong.png")}),$(".item").find(".checkbox").hide(),$(".item").find(".station").length&&$(".item").find(".checkbox").show()}}})},o=function(a,b){$("#J_album-alert").on("click",".close-btn",function(){$("#J_album-alert, #J_body-mask").hide(),e.hideMask(),$("#J_album-alert .new-myalbum").removeClass("showinput")}).on("click",".new-btn",function(){$("#J_album-alert .new-myalbum").addClass("showinput"),$("#J_album-alert .new-myalbum").find(".input").focus()}).on("click",".cancel-btn",function(){$("#J_album-alert .new-myalbum").removeClass("showinput")}).on("click",".ok-btn",function(){var a=$(this),b=$("#J_album-alert .input"),c=$.trim(b.val());return a.hasClass("disabled")?!1:c?(m(c),void $("#J_album-alert .ok-btn").addClass("disabled")):b.focus()}).on("click",".item",function(){var a=$(this),c=a.attr("albumid"),d=$("#J_album-alert"),e=d.attr("ids"),f=d.attr("type"),g=d.attr("album_ids");n(c,e,f,g,b)})};h.showAddMyablumBox=function(a,b,c,d){var g=$("#J_album-alert");return""===a?!1:(g.length<1&&($(document.body).append(f.myalbumAlertHtml),g=$("#J_album-alert"),o(g,d)),a&&g.attr({ids:a,type:b,album_ids:c}).show(),e.showMask(),g.show(),$("#J_album-alert .close-btn").show(),j(function(a){var b=BEME.template(f.myalbumItemHtml,{list:a});g.find(".item").remove(),g.find(".list").append(b)}),!0)};var p=function(){$("#play_edit").on("click",function(){("none"===$(".item").find(".checkbox")[0].style.display||""===$(".item").find(".checkbox")[0].style.display)&&($(".select-all").show(),$(".myalbum .title").hide(),$(".item").find(".checkbox").show(),$(".item").find(".checkbox span").length&&($(".item").find(".checkbox span").hide(),$(".item").find(".checkbox img").show()),$.each($(".item .item-a"),function(a,b){$(b).attr("href","javascript:void(0);")}))}),d.newPlayEvent(),$(".select-all .left").on("click",function(){var a=$(this).parent(),b=a.find(".check_all").attr("value"),c=$(".item").find(".checkbox");0==+b?(a.find("img").attr("src","./static/images/xuanze.png"),a.find(".check_all").attr("value",1),$.each(c,function(a,b){$(b).find("img").attr("src","./static/images/xuanze.png"),$(b).attr("value",1)}),$("#delete").removeClass("content_add"),$("#delete").addClass("content")):(a.find("img").attr("src","./static/images/xuanzekong.png"),a.find(".check_all").attr("value",0),$.each(c,function(a,b){$(b).find("img").attr("src","./static/images/xuanzekong.png"),$(b).attr("value",0)}),$("#delete").removeClass("content"),$("#delete").addClass("content_add"))}),$(".select-all #cancel").on("click",function(){$(".select-all").hide(),$(".myalbum .title").show(),$(".item").find(".checkbox").hide(),$.each($(".item"),function(a,b){var c=$(b).attr("sid"),d="#!m=myplay&id="+c;$(b).find(".item-a").attr("href",d)})}),$("#J_play_list").on("click",".checkbox",function(){d.check(this)}),$("#J_play_list").on("click",".item-a",function(){var a=$(this).parent().find(".checkbox");d.check(a)}),$(".select-all #delete").on("click",function(){var a=$(".item"),b=[];if($.each(a,function(a,c){var d=$(c),e=d.find(".checkbox").attr("value");1===+e&&b.push(d.attr("sid"))}),0===b.length);else{var c={};c.content="确定删除所选歌单？",e.showAlert(c,function(){l(b.join(","))})}})};h.init=function(){e.setTitle("我创建的歌单"),$(".back-btn").show(),a.headerMenu(),$("#editplay").show(),e.showHeader(),k(),p()},h.uninit=function(){$("#editplay, .myalbum .title .check, #J_play_list, #delete_play, #cancel_edit,#J_newplay-box").off("click")}});