/*! 09-05-2016 */
define("page/fminfo",["comm/utils","comm/url","comm/request","comm/pushsong","comm/clickevent","page/myalbum","helper/app","helper/playerbar","require","exports"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k={},l=[],m=!1,n=function(b){var c=g.getUA(1);c>0&&$(".action-box .share").show();var d=$("#J_top-box");if(d.find(".img-cover").attr("imgsrc",a.imageUrlStationHead(b.station.url,1)),1==b.station.is_regular?d.find(".uptime").text("定时更新"):d.find(".uptime").text("每"+a.formatPushTime(b.station.push_time)+"更新"),d.find(".name").text(b.station.name),d.find(".playbox").text(b.station.demand_num),b.subscription){m=!0;var e=$("#J_description").parent();e.hasClass("btn-subscribed")||e.addClass("btn-subscribed"),$("#J_description").text("已订阅")}else{var e=$("#J_description").parent();e.hasClass("btn-subscribed")&&e.removeClass("btn-subscribed"),$("#J_description").text("订阅")}if($("#J_album-desc").text(b.station.description),$("#J_ordernum").text(b.station.subscription_num),b.radios?$("#J_songnum").text(b.radios.length):$("#J_songnum").text(0),b.tags){d=$("#J_info-box");var f="";$.each(b.tags,function(b,c){var d=a.getRandColor();f+='<li style="color:'+d+";border-color:"+d+'">'+c.name+"</li>"}),d.find(".tags").html(f)}$.each(b.radios,function(a,c){c.tagval=b.station.id}),l=b.radios,f=a.template("J_temp-item",{list:l,flag:!0}),$("#J_song-box").html(f),$.each(b.radios,function(a,b){b._type="station",b.tag="station",k[b.id]=b}),g.showImage(),g.backScroll()},o=function(b){c.getRequest({url:BEME.APIURL+"/station/radiolist",type:"post",data:{id:b,uid:a.getUid()},successfn:function(a){g.loaded(),0===a.code&&n(a.data)}})},p=function(b){c.getRequest({url:BEME.APIURL+"/station/getStationPushTime",type:"post",data:{id:b,uid:a.getUid()},successfn:function(b){if(g.loaded(),0===b.code){var c=b.data.name+"电台节目将在每";c+=1==b.data.is_regular?"次更新的":a.formatPushTime(b.data.push_time),c+=b.data.push_time_hours+":00点准时推送给玩具，记得收听哦",g.showAlert(c)}}})};window.onSubscribeRadioResult=function(a,b,c){if(1!=b){if(0==b)if(c){var d=$("#J_description").parent();d.hasClass("btn-subscribed")&&($("#J_description").text("订阅"),d.removeClass("btn-subscribed")),m=!1,g.showTips("取消订阅成功!")}else g.showTips("取消订阅失败!")}else if(c){var d=$("#J_description").parent();p(a),$("#J_description").text("已订阅"),d.addClass("btn-subscribed")}else g.showTips("订阅失败!")};var q=function(b){$("#J_album-desc").on("click",function(){var a=$(this);a.attr("block")?(a.css("display","-webkit-box"),a.attr("block",null)):(a.css("display","block"),a.attr("block",1))}),$("#J_info-box .btn-subscribe").on("click",function(){try{var a=$(this);if(a.hasClass("btn-subscribed")){var c={};c.content="确定不再订阅该电台？",g.showAlert(c,function(){window.bemetoy.subscribeRadio(b,0,"")})}else{var e=d.getUid();if(e.to<1)return void(window.location.href="#!m=pushfail&type=station&text=2");window.bemetoy.subscribeRadio(b,1,"")}}catch(f){}}),$("#J_song-box").on("click",".item .item-a .title-box,.item .item-a .desc",function(){e.pushSong($(this).parent())}),$("#J_song-box").on("click",".item-play",function(){e.audition(k,$(this).parent())}),$(".action-box").on("click",".play-btn",function(){e.pushAllSong(this)});var c=!0;$("#J_option-btn").on("click",function(){c?($("#J_option-btn").removeClass("option-btn"),$("#J_option-btn").addClass("option-btn-on")):($("#J_option-btn").removeClass("option-btn-on"),$("#J_option-btn").addClass("option-btn")),c=!c,l.reverse();var b=a.template("J_temp-item",{list:l,flag:c});$("#J_song-box").html(b)}),$(".top").on("click",".edit",function(){location.href="#!m=descriptiontime&id="+b}),$(".top").on("click",".cancel",function(){var a=($(this),{});a.content="确定不再订阅该电台？",g.showAlert(a,function(){try{window.bemetoy.subscribeRadio(b,0,"")}catch(a){alert(a)}}),$(".top").hide()}),$(".action-box").on("click",".share",function(){e.shareToWeixin(b,"station",b)})};j.init=function(){g.setTitle("电台"),$(".back-btn").show(),a.headerMenu(),$("#myplay").show(),m=!1;var c=b.getParams();g.showHeader(),o(c.id),q(c.id)},j.uninit=function(){$("#J_album-desc, #J_song-box, #J_option-btn, #J_info-box .btn-subscribe").off("click")}});